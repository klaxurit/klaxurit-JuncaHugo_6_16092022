{% extends 'base.html.twig' %}

{% block stylesheets %}
<link rel="stylesheet" href="{{ asset('assets/css/_main.css') }}">
{% endblock %}

{% block title %}Trick{% endblock %}

{% block body %}

<div class="modal fade" id="videomodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>        
                <!-- 16:9 aspect ratio -->
                <div class="embed-responsive embed-responsive-16by9">
                <iframe class="embed-responsive-item" src="" id="video"  allowscriptaccess="always" allow="autoplay"></iframe>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="imagemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">              
      <div class="modal-body">
      	<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        <img src="" class="imagepreview" style="width: 100%;" >
      </div>
    </div>
  </div>
</div>

<div class="container main my-5">
    <div class="text-end">
        <a href="{{ path('app_trick_edit', {'id': trick.id}) }}" class="btn btn-m btn-primary"><i class="bi bi-pencil-fill"></i></a>
        {{ include('trick/_delete_form.html.twig') }}
    </div>

    <div class="d-flex flex-column justify-content-center">
    <h1 class="text-center my-5">{{trick.name}}</h1>

    <div id="carousel">
        {% for media in trick.medias %}
        {% if media.type is same as("Image") %}
            <div class="item"><a href="#" class="pop"><img data-id="{{ media.id }}" class="trick__img" src="{{asset('/uploads/' ~ media.fileName)}}" alt="{{ media.alt }}" title="{{ media.alt }}"></a></div>
            {% else %}
            <div class="item"><a href="#" class="popVideo" data-toggle="modal" data-src="{{ media.url }}" data-target="#myModal"><iframe class="trick__video" src="{{ media.url }}" frameborder="0"></iframe></a></div>
        {% endif %}
        {% endfor %}
    </div>

    <p class="text-justify text-center mt-3">{{trick.description}}</p>

    <div class="trick__groups text-center">
        <span class="badge rounded-pill text-bg-primary">{{trick.trickGroup.name}}</span>
    </div>

    <div class="trick__separator my-3">
        <hr class="rounded">
    </div>

    {% include('trick/_comment.html.twig') %}
    </div>

    <a href="{{ path('app_trick_index') }}" class="btn btn-m btn-secondary">Back to list</a>
    
</div>


{% endblock %}


{% block javascripts %}
    <script src="{{ asset('assets/js/slider.js') }}" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    $(document).ready(function() {
    // Gets the video src from the data-src on each button

        var $videoSrc;  
        $('.video-btn').click(function() {
            $videoSrc = $(this).data( "src" );
        });
        console.log($videoSrc);
        
        // when the modal is opened autoplay it  
        $('#myModal').on('shown.bs.modal', function (e) {
            
        // set the video src to autoplay and not to show related video. Youtube related video is like a box of chocolates... you never know what you're gonna get
        $("#video").attr('src',$videoSrc + "?autoplay=1&amp;modestbranding=1&amp;showinfo=0");

        })

        // stop playing the youtube video when I close the modal
        $('#myModal').on('hide.bs.modal', function (e) {
            // a poor man's stop video
            $("#video").attr('src',$videoSrc); 
        })
    });
    </script>
    <script>
    $(function() {
		$('.pop').on('click', function() {
			$('.imagepreview').attr('src', $(this).find('img').attr('src'));
			$('#imagemodal').modal('show');   
		});		
    });
    $(function() {
		$('.popVideo').on('click', function() {
			$('.embed-responsive-item').attr('src', $(this).find('iframe').attr('src'));
			$('#videomodal').modal('show');   
		});		
    });
    </script>
{% endblock %}  